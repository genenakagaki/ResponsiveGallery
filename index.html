<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <title>Responsive Gallery</title>

    <style>
        .responsiveGallery .rg-view {
            position: relative;
            width: 100%;
            height: 200px;
            white-space: nowrap;
            overflow: hidden;
            z-index: 1;
        }

        .responsiveGallery .rg-container {
            position: absolute;
            height: 100%;
            left: 0;
            display: block;
        }

        .responsiveGallery .rg-container .rg-item {
            height: 100%;
            float: left;
            padding: 0 1px;
        }

        .responsiveGallery .rg-container .rg-item img {
            height: 100%;
        }

        .responsiveGallery .controls button {
            position: absolute;
            z-index: 10;
            height: 100%;
            background: none;
            border: 1px solid black;
        }

        .responsiveGallery .controls .next {
            left: 0;
        }

        .responsiveGallery .controls .prev {
            right: 0;
        }
    </style>
</head>

<body>
    <h1>Responsive Gallery</h1>

    <div class="responsiveGallery">

        <div class="rg-view">
            <div class="rg-container">
                <div class="rg-item active" data-pos="1">
                    <img src="http://via.placeholder.com/100x600" />
                </div>
                <div class="rg-item" data-pos="2">
                    <img src="http://via.placeholder.com/200x500" />
                </div>
                <div class="rg-item" data-pos="3">
                    <img src="http://via.placeholder.com/300x400" />
                </div>
                <div class="rg-item" data-pos="4">
                    <img src="http://via.placeholder.com/400x300" />
                </div>
                <div class="rg-item" data-pos="5">
                    <img src="http://via.placeholder.com/500x200" />
                </div>
            </div>

            <div class="controls">
                <button class="next">&lt;</button>
                <button class="prev">&gt;</button>
            </div>
        </div>
    </div>
</body>

<script src="./anime.min.js"></script>
<script>
    function log(message) {
        var D = true;
        if (D)
            console.log(message);
    }

    function ResponsiveGallery() {
        this.rg = document.querySelector('.responsiveGallery');
        this.container = this.rg.querySelector('.rg-container');
        this.itemCount = this.rg.querySelectorAll('.rg-item').length;

        // Length of all the images combined
        this.containerWidth = 0;

        // Drag
        this.isDragEnabled = false;
        this.isDragging = false;
        this.dragStartX = 0;
        this.dragStartLeft = 0;

        this.init();
    }

    ResponsiveGallery.prototype.init = function () {
        log("ResponsiveGallery initialize");

        // Calculate length of all the images combined
        var items = this.container.querySelectorAll('.rg-item');
        for (var i = 0; i < this.itemCount; i++) {
            this.containerWidth += items[i].clientWidth;
        }

        // Set width of container to total length 
        this.container.style.width = this.containerWidth + 'px';

        // Add listeners to controls
        var leftControl = this.rg.querySelector('.controls .next');
        var rightControl = this.rg.querySelector('.controls .prev');
        var rgInstance = this;
        leftControl.addEventListener('click', function () {
            rgInstance.movePrev();
        });
        rightControl.addEventListener('click', function () {
            rgInstance.moveNext();
        });
    }

    ResponsiveGallery.prototype.getItemAt = function (pos) {
        return this.rg.querySelector('[data-pos="' + pos + '"]');
    }

    ResponsiveGallery.prototype.getActive = function () {
        // Get active item and remove active class
        return this.rg.querySelector('.rg-item.active');
    }

    ResponsiveGallery.prototype.setActive = function (pos) {
        log('set Active to ' + pos);

        // Get active item and remove active class
        var activeItem = this.getActive();
        activeItem.classList.remove('active');

        // Get new pos item and set as current
        activeItem = this.rg.querySelector('[data-pos="' + pos + '"]');
        activeItem.classList.add('active');

        anime({
            targets: '.responsiveGallery .rg-container',
            left: '-' + activeItem.offsetLeft + 'px',
            duration: 400,
            easing: 'easeInOutCirc'
        });
    }

    ResponsiveGallery.prototype.moveNext = function () {
        var activeItem = this.getActive();

        // If white space will be visible after move
        var screenWidth = document.body.clientWidth;
        var containerRightSide = this.containerWidth + parseInt(this.container.style.left) - activeItem.clientWidth
        if (screenWidth - containerRightSide < 0) {
            var firstItem = this.container.firstElementChild;
            this.rg.querySelector('.rg-container').insertAfter(activeItem, firstItem);
        }

        // Get new position
        var newPos = activeItem.dataset.pos;
        newPos++;
        if (newPos > this.itemCount) {
            newPos = 1;
        } else {
            var lastPos = this.container.lastElementChild.dataset.pos;
            if (lastPos == newPos) {
                log("aaaa");
            }
        }

        this.setActive(newPos);
    }

    ResponsiveGallery.prototype.movePrev = function () {
        var activeItem = this.getActive();

        // Get new position
        var newPos = activeItem.dataset.pos;
        newPos--;
        if (newPos < 1)
            newPos = this.itemCount;

        this.setActive(newPos);
    }

    ResponsiveGallery.prototype.getCurrentPosition = function () {
        log(this.rg.style.left);
    }

    var rg;
    window.addEventListener('load', function () {
        rg = new ResponsiveGallery();

    });

        // // Handle sliding to the left
        // // (bring the rightmost img to the left)
        // var firstItem = this.rg.querySelector('.rg-item');
        // var lastItem = this.rg.querySelector('.rg-item:last-child');
        // this.rg.querySelector('.rg-container').insertBefore(lastItem, firstItem);
        // // slide the rg-container to show the original first item
        // this.container.style.left = '-' + lastItem.offsetWidth + 'px';
</script>

</html>